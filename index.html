<!DOCTYPE html>
<html lang="zh-CN">
  <head>
	<meta name="generator" content="Hugo 0.63.2" />
    
      <title>焉知非鱼</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<meta name="referrer" content="never" />
<link rel="canonical" href="https://ohmypanda.github.io/" />
<link rel="stylesheet" href="https://ohmypanda.github.io/style.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:500&display=swap" media="print" onload="this.media='all'">
<link rel="shortcut icon" href="https://ohmypanda.github.io/favicon.ico">

<meta property="og:title" content="首页" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ohmypanda.github.io/" />
<meta property="og:updated_time" content="2020-06-11T00:00:00+00:00" />


<link rel="alternate" type="application/rss+xml" href="/atom.xml" title="焉知非鱼" />
<link rel="alternate" type="application/json" href="/index.json" title="焉知非鱼" />

    
  
  <link rel="prefetch" href="/page/2/">

  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="https://ohmypanda.github.io" class="logo" style="text-decoration: none;">
  
    <span class="logo__text">焉知非鱼</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu hidden">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/archives/">归档</a></li>
        
      
        
          <li><a href="/about/">关于</a></li>
        
      
        
          <li><a href="/tags/">标签</a></li>
        
      
    

                <li><a href="/search/"><svg t="1556783211810" class="search-box-icon" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2078" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"></style></defs><path d="M981.39652054 920.86314525L704.56522859 644.0318533a366.65501012 366.65501012 0 1 0-61.73503038 65.64040943L917.55859375 984.40065827z m-856.17925347-493.12920861a284.19142939 284.19142939 0 1 1 283.89101562 284.19142939A284.49184317 284.49184317 0 0 1 125.06706019 427.73393664z" fill="" p-id="2079" data-spm-anchor-id="a313x.7781069.0.i2"></path></svg></a></li>
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/archives/">归档</a></li>
      
    
      
        <li><a href="/about/">关于</a></li>
      
    
      
        <li><a href="/tags/">标签</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger hidden">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  
  
    
  
  

  <div class="posts">
    
    
    <div class="post on-list daily">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/2020-06-11/">Rust 生命周期</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-11 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/rust/">Rust</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <p>生命周期太难了, 哭了。</p>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list daily">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/elink-paper/">Zz</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-11 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/%E7%94%B5%E7%BA%B8%E4%B9%A6/">电纸书</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <p><img loading='lazy' src="https://s3-img.meituan.net/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0h/1c/jc_327131.jpg@596w_1l.jpg" alt="img"  /></p>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list daily">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/test-image/">照片</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-11 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/%E9%A3%8E%E6%99%AF/">风景</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <p><img loading='lazy' src="https://s3-img.meituan.net/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0k/gx/fc_276347.jpg@596w_1l.jpg" alt="img"  /></p>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list daily">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/hugo-music/">网易云音乐歌单</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-11 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/music/">music</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <p>看剧不如听歌。</p>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<style type="text/css">.dark-theme .aplayer{background:#212121}.dark-theme .aplayer.aplayer-withlist .aplayer-info{border-bottom-color:#5c5c5c}.dark-theme .aplayer.aplayer-fixed .aplayer-list{border-color:#5c5c5c}.dark-theme .aplayer .aplayer-body{background-color:#212121}.dark-theme .aplayer .aplayer-info{border-top-color:#212121}.dark-theme .aplayer .aplayer-info .aplayer-music .aplayer-title{color:#fff}.dark-theme .aplayer .aplayer-info .aplayer-music .aplayer-author{color:#fff}.dark-theme .aplayer .aplayer-info .aplayer-controller .aplayer-time{color:#eee}.dark-theme .aplayer .aplayer-info .aplayer-controller .aplayer-time .aplayer-icon path{fill:#eee}.dark-theme .aplayer .aplayer-list{background-color:#212121}.dark-theme .aplayer .aplayer-list::-webkit-scrollbar-thumb{background-color:#999}.dark-theme .aplayer .aplayer-list::-webkit-scrollbar-thumb:hover{background-color:#bbb}.dark-theme .aplayer .aplayer-list li{color:#fff;border-top-color:#666}.dark-theme .aplayer .aplayer-list li:hover{background:#4e4e4e}.dark-theme .aplayer .aplayer-list li.aplayer-list-light{background:#6c6c6c}.dark-theme .aplayer .aplayer-list li .aplayer-list-index{color:#ddd}.dark-theme .aplayer .aplayer-list li .aplayer-list-author{color:#ddd}.dark-theme .aplayer .aplayer-lrc{text-shadow:-1px -1px 0 #666}.dark-theme .aplayer .aplayer-lrc:before{background:-moz-linear-gradient(top, #212121 0%, rgba(33,33,33,0) 100%);background:-webkit-linear-gradient(top, #212121 0%, rgba(33,33,33,0) 100%);background:linear-gradient(to bottom, #212121 0%, rgba(33,33,33,0) 100%);filter:progid:DXImageTransform.Microsoft.gradient( startColorstr='#212121', endColorstr='#00212121',GradientType=0 )}.dark-theme .aplayer .aplayer-lrc:after{background:-moz-linear-gradient(top, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);background:-webkit-linear-gradient(top, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);background:linear-gradient(to bottom, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);filter:progid:DXImageTransform.Microsoft.gradient( startColorstr='#00212121', endColorstr='#cc212121',GradientType=0 )}.dark-theme .aplayer .aplayer-lrc p{color:#fff}.dark-theme .aplayer .aplayer-miniswitcher{background:#484848}.dark-theme .aplayer .aplayer-miniswitcher .aplayer-icon path{fill:#eee}</style>
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js auto="https://music.163.com/#/playlist?id=3155709" theme="#2980b9"></meting-js>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list reading">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/2020-06-11/">语法</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-11 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/rust/">Rust</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <p>Rust 语法太难记了, 反直觉。又哭了。</p>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list /">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/about/">关于</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-10 22:49:00
          </span>
        

        
      </div>

      

      <div class="post-content $PostCate">
      
        <p>Perl 6 is died, Long live Raku.</p>
<h3 id="学习正则表达式">学习正则表达式</h3>
<p>regexes in <a href="https://docs.raku.org">raku</a> is awesome!</p>
<h3 id="学习-grammar">学习 Grammar</h3>
<p><a href="https://docs.raku.org/language/grammar_tutorial">Grammar</a> in <a href="https://docs.raku.org">raku</a> is awesome!</p>
<h3 id="学习-action">学习 Action</h3>
<p><a href="https://docs.raku.org/language/grammars#index-entry-Actions">Action</a> in raku is awesome!</p>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list chat">
    
            <div class="post-meta">
        
          <span class="post-date">
            2020-06-10 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/rust/">Rust</a>&nbsp;
          
        </span>
        
      </div>
      <div class="post-content $PostCate">
        <a href="https://ohmypanda.github.io/2020-06-10/" rel="link"><img loading="lazy" class="post-avatar avatar" src=https://gravatar.loli.net/avatar/ba83fa02fc4b2ba621514941307e21be ></a>
          Rust 太难了。 Rust 怎么这么难啊！ 真的太难了。 磕学家才学得会。
      </div>
    
    </div>
    
    
    <div class="post on-list chat">
    
            <div class="post-meta">
        
          <span class="post-date">
            2020-06-10 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/rust/">Rust</a>&nbsp;
          
        </span>
        
      </div>
      <div class="post-content $PostCate">
        <a href="https://ohmypanda.github.io/2020-06-11/" rel="link"><img loading="lazy" class="post-avatar avatar" src=https://gravatar.loli.net/avatar/ba83fa02fc4b2ba621514941307e21be ></a>
          Rust 太难了, 哭了。
      </div>
    
    </div>
    
    
    <div class="post on-list chat">
    
            <div class="post-meta">
        
          <span class="post-date">
            2020-06-09 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/%E5%A4%A7%E5%85%B4/">大兴</a>&nbsp;
          
        </span>
        
      </div>
      <div class="post-content $PostCate">
        <a href="https://ohmypanda.github.io/2020-06-09/" rel="link"><img loading="lazy" class="post-avatar avatar" src=https://gravatar.loli.net/avatar/ba83fa02fc4b2ba621514941307e21be ></a>
          2020年夏天, 天气晴, 大兴区。
      </div>
    
    </div>
    
    
    <div class="post on-list daily">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/tianchi/">天池</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-04 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/%E9%A3%8E%E6%99%AF/">风景</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <p><img loading='lazy' src="https://s3-img.meituan.net/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0d/yx/s7_80180.jpg@596w_1l.jpg" alt="img"  /></p>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list daily">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/cloud01/">曙暮光条</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-03 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/%E9%A3%8E%E6%99%AF/">风景</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <p><img loading='lazy' src="https://s3-img.meituan.net/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0k/gx/qs_277102.jpg@596w_1l.jpg" alt="img"  /></p>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list daily">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/cook/">做饭</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-06-01 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/%E9%94%85%E9%87%8C%E6%9C%89%E9%A5%AD/">锅里有饭</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <p><img loading='lazy' src="https://s3-img.meituan.net/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0f/xv/4e_184477.jpg@596w_1l.jpg" alt="img"  /></p>

        
      
      </div>
    
    </div>
    
    
    <div class="post on-list coding">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/extract-ipconfig/">提取 ipconfig 命令的部分输出</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-05-19 23:41:33
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/grammar/">Grammar</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <h3 id="数据样例">数据样例</h3>
<p>下面这段文本是 <code>IPCONFIG /ALL</code> 命令的输出结果:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">Windows IP 配置

   主机名  . . . . . . . . . . . . . : Win10-2020QJFDK
   主 DNS 后缀 . . . . . . . . . . . : 
   节点类型  . . . . . . . . . . . . : 混合
   IP 路由已启用 . . . . . . . . . . : 否
   WINS 代理已启用 . . . . . . . . . : 否

以太网适配器 本地连接* 9:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . : 
   描述. . . . . . . . . . . . . . . : Sangfor SSL VPN CS Support System VNIC
   物理地址. . . . . . . . . . . . . : 00-FF-05-0D-13-A2
   DHCP 已启用 . . . . . . . . . . . : 否
   自动配置已启用. . . . . . . . . . : 是

无线局域网适配器 WLAN:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . : 
   描述. . . . . . . . . . . . . . . : Realtek RTL8192EU Wireless LAN 802.11n USB 2.0 Network Adapter
   物理地址. . . . . . . . . . . . . : 30-B4-9E-40-FF-0C
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是

无线局域网适配器 本地连接* 10:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . : 
   描述. . . . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter
   物理地址. . . . . . . . . . . . . : 32-B4-9E-40-FF-0C
   DHCP 已启用 . . . . . . . . . . . : 是
   自动配置已启用. . . . . . . . . . : 是

以太网适配器 以太网:

   连接特定的 DNS 后缀 . . . . . . . : 
   描述. . . . . . . . . . . . . . . : Realtek PCIe GBE Family Controller
   物理地址. . . . . . . . . . . . . : 54-E1-AD-48-66-22
   DHCP 已启用 . . . . . . . . . . . : 否
   自动配置已启用. . . . . . . . . . : 是
   本地链接 IPv6 地址. . . . . . . . : fe80::4195:49da:a7ec:9e68%6(首选) 
   IPv4 地址 . . . . . . . . . . . . : 192.168.0.68(首选) 
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 192.168.0.1
   DHCPv6 IAID . . . . . . . . . . . : 324329901
   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-26-4E-B2-11-54-E1-AD-48-66-22
   DNS 服务器  . . . . . . . . . . . : 61.128.128.68
   TCPIP 上的 NetBIOS  . . . . . . . : 已启用
</code></pre></div><p>分别提取含有&quot;适配器&quot;文字下面的「描述」、「物理地址」、「IP地址」、「子网掩码」、「默认网关」、「DNS 服务器」等信息。某些适配器下面可能实际没有「IP地址」、「子网掩码」、「默认网关」、「DNS 服务器」等，有就提取，没有就略过。</p>
<h3 id="grammar">Grammar</h3>
<pre><code class="language-raku" data-lang="raku">unit grammar IPConfig::Grammar;

token TOP { &lt;section&gt;+ %% \n* }
token section {
    &lt;header&gt;
    \n
    &lt;config&gt;+
}

token header { ^^ \N+  \n         }
token config { ^^ \s+ \N+ $$ \n*  }
</code></pre><h3 id="action">Action</h3>
<pre><code class="language-raku" data-lang="raku">unit class IPConfig::Action;

method TOP($/) {
    make $/&lt;section&gt;».made;
}

method section($/) {
    my $configs = $/&lt;config&gt;».made;
    if $configs.elems &gt; 0 {
        make ~$/&lt;header&gt;  ~ $configs.join('');
    } else {
        make Empty;
    }
}

method header($/) {
    make ~$/;
}

method config($/ is copy) {
    my $text = ~$/;
    if $text.contains(/'描述' | '物理地址' | IPv[4|6] ' ' 地址 | '子网掩码' | DNS ' ' 服务器/) {
         $/.make(~$/);
    } else {
        make Empty;
    }
}
</code></pre><h3 id="提取脚本">提取脚本</h3>
<pre><code class="language-raku" data-lang="raku">use lib '.';
use IPConfig::Grammar;
use IPConfig::Action;

my $ipconfig = IPConfig::Grammar.parsefile(
    &quot;data/ifconfig.txt&quot;,
    :actions(IPConfig::Action)
).made;

.Str.say for @$ipconfig;
</code></pre><h3 id="输出">输出</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">以太网适配器 本地连接* 9:
   描述. . . . . . . . . . . . . . . : Sangfor SSL VPN CS Support System VNIC
   物理地址. . . . . . . . . . . . . : 00-FF-05-0D-13-A2

无线局域网适配器 WLAN:
   描述. . . . . . . . . . . . . . . : Realtek RTL8192EU Wireless LAN 802.11n USB 2.0 Network Adapter
   物理地址. . . . . . . . . . . . . : 30-B4-9E-40-FF-0C

无线局域网适配器 本地连接* 10:
   描述. . . . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter
   物理地址. . . . . . . . . . . . . : 32-B4-9E-40-FF-0C

以太网适配器 以太网:
   描述. . . . . . . . . . . . . . . : Realtek PCIe GBE Family Controller
   物理地址. . . . . . . . . . . . . : 54-E1-AD-48-66-22
   本地链接 IPv6 地址. . . . . . . . : fe80::4195:49da:a7ec:9e68%6(首选) 
   IPv4 地址 . . . . . . . . . . . . : 192.168.0.68(首选) 
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 192.168.0.1
   DNS 服务器  . . . . . . . . . . . : 61.128.128.68
</code></pre></div>
        
      
      </div>
    
    </div>
    
    
    <div class="post on-list chat">
    
            <div class="post-meta">
        
          <span class="post-date">
            2020-05-11 00:00:00
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/awesome/">Awesome</a>&nbsp;
          
        </span>
        
      </div>
      <div class="post-content $PostCate">
        <a href="https://ohmypanda.github.io/2020-05-11/" rel="link"><img loading="lazy" class="post-avatar avatar" src=https://gravatar.loli.net/avatar/ba83fa02fc4b2ba621514941307e21be ></a>
          Less Than Awesome.
      </div>
    
    </div>
    
    
    <div class="post on-list coding">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/extract-sections-with-double-percent/">使用 %% 提取文本块儿</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-05-06 14:14:08
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/grammar/">Grammar</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <h3 id="数据样例">数据样例</h3>
<p>section.txt 中的本文为样例数据:</p>
<pre><code>123,456,789
=begin code
999,333,666
145,123,120
=end code
10,20,30
10,10,10
=begin code
567,555,578
678,679,665
710,720,715
=end code
321,654,987
=begin code
312,555
=end code
</code></pre><p>要求把 <code>=begin code</code> 和 <code>=end code</code> 之间的所有数字分别提取出来。</p>
<h3 id="grammar">Grammar</h3>
<p>Grammar 的结构如下, 其中 Section 目录下分别是 Grammar 和 Action 模块, data 目录下是样例数据 section.txt:</p>
<pre><code>├── Section
│   ├── Actions.pm6
│   └── Grammar.pm6
├── data
│   ├── section.txt
├── extract-section.p6
</code></pre><pre><code class="language-perl6" data-lang="perl6">use Grammar::Debugger;
use Grammar::Tracer;

unit grammar Section::Grammar;

token TOP {
   ^  &lt;section&gt;+ %% &lt;separator&gt; $
}

token section {
    &lt;line&gt;+
}

token line {
   ^^ [\d+]+ %% ',' $$ \n
}

token separator {
    |  ^^ '=begin code' $$ \n
    |  ^^ '=end code' $$ \n*
}
</code></pre><p>其中 <code>Grammar::Debugger</code> 和 <code>Grammar::Tracer</code> 模块用于调试 grammar, 需要放在 grammar 模块的行首:</p>
<pre><code class="language-perl6" data-lang="perl6">use Grammar::Debugger;
use Grammar::Tracer;
</code></pre><h3 id="action">Action</h3>
<pre><code class="language-perl6" data-lang="perl6">unit class Section::Actions;

method TOP($/) {
     make $/.values».made;
}

method section($/) {
    make ~$/.trim;
}

method line($/) {
    make ~$/.trim;
}

method separator($/) {
    make Empty;
}
</code></pre><h3 id="解析">解析</h3>
<h4 id="不使用-action">不使用 Action</h4>
<pre><code class="language-perl6" data-lang="perl6">use lib '.';
use Section::Grammar;

my $parsed = Section::Grammar.parsefile(@*ARGS[0] // 'data/section.txt');
.Str.say for $parsed&lt;section&gt;;
</code></pre><h4 id="输出">输出</h4>
<pre><code>123,456,789

999,333,666
145,123,120

10,20,30
10,10,10

567,555,578
678,679,665
710,720,715

321,654,987

312,555
</code></pre><h4 id="使用-action">使用 Action</h4>
<pre><code class="language-perl6" data-lang="perl6">use lib '.';
use Section::Grammar;
use Section::Actions;

my $parsed = Section::Grammar.parsefile(
    @*ARGS[0] // 'data/section.txt',
    :actions(Section::Actions)
).made;

.Str.say for @$parsed;
</code></pre><h4 id="输出-1">输出</h4>
<pre><code>123,456,789
999,333,666
145,123,120
10,20,30
10,10,10
567,555,578
678,679,665
710,720,715
321,654,987
312,555
</code></pre>
        
      
      </div>
    
    </div>
    
    
    <div class="post on-list coding">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/extract-sections-again/">再用 %% 提取文本块儿</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-05-06 14:14:08
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/grammar/">Grammar</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <h3 id="数据样例">数据样例</h3>
<pre><code>Here's some unimportant text.
=begin code
This code block is what we're after.
We'll use 'ff' to get it.
=end code
More unimportant text.
=begin code
I want this line.
and this line as well.
HaHa.
=end code
More unimport text.
=begin code
Let's to go home.
=end code
</code></pre><h3 id="grammar">Grammar</h3>
<pre><code class="language-perl6" data-lang="perl6">use Grammar::Debugger;
use Grammar::Tracer;

unit grammar Range::Grammar;

token TOP {
   ^  &lt;un-important-line&gt;+ %% &lt;section&gt; $
}

token section {
   &lt;begin&gt; ~ &lt;end&gt; &lt;line&gt;+?
}

token un-important-line {
    ^^ \N+ )&gt; \n*
}

token line {
    ^^ \N+ )&gt; \n*
}

token begin {
    ^^ '=begin code' $$ \n*
}

token end {
    ^^ '=end code' $$ \n*
}
</code></pre><h3 id="action">Action</h3>
<pre><code class="language-perl6" data-lang="perl6">unit class Range::Actions;

method TOP($/) {
     make $/.values».made;
}

method section($/) {
    make $/&lt;line&gt;».made;
}

method line($/) {
    make ~$/.trim;
}

method un-important-line($/) {
    make Empty;
}

method begin($/) {
    make Empty;
}

method end($/) {
    make Empty;
}
</code></pre><h3 id="提取">提取</h3>
<pre><code class="language-perl6" data-lang="perl6">#!/usr/bin/env perl6

use lib '.';
use Range::Grammar;
use Range::Actions;

my $parsed = Range::Grammar.parsefile(
        @*ARGS[0] // 'data/flip-flop.txt',
        :actions(Range::Actions)
        ).made;

for @$parsed -&gt; $line {
    say $line.raku;
    say '-' x 35;
}
</code></pre><h3 id="输出">输出</h3>
<pre><code>$[&quot;This code block is what we're after.&quot;, &quot;We'll use 'ff' to get it.&quot;]
-----------------------------------
$[&quot;I want this line.&quot;, &quot;and this line as well.&quot;, &quot;HaHa.&quot;]
-----------------------------------
$[&quot;Let's to go home.&quot;]
-----------------------------------
</code></pre>
        
      
      </div>
    
    </div>
    
    
    <div class="post on-list coding">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/extract-sections/">提取文本块儿</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-05-05 22:11:48
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/grammar/">Grammar</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <h3 id="数据样例">数据样例</h3>
<pre><code>Here's some unimportant text.
=begin code
This code block is what we're after.
We'll use 'ff' to get it.
=end code
More unimportant text.
=begin code
I want this line.
and this line as well.
HaHa
=end code
More unimport text.
=begin code
Let's to go home.
=end code
</code></pre><p>要求提取 <code>=begin code</code> 和 <code>=end code</code> 之间的文本块儿。</p>
<h3 id="grammar">Grammar</h3>
<pre><code class="language-perl6" data-lang="perl6">grammar ExtractSection {
  token start   { ^^ '=begin code' \n          }
  token finish  { ^^ '=end code' \n            }
  token line    { ^^ \N+)&gt; \n                  }
  token section { &lt;start&gt; ~ &lt;finish&gt; &lt;line&gt;+?  }
  token comment { ^^\N+ \n                     }
  token TOP     { [&lt;section&gt; || &lt;comment&gt;]+    } 
}
</code></pre><h3 id="action">Action</h3>
<pre><code class="language-perl6" data-lang="perl6">class ExtractSectionAction {
    method TOP($/)     { make @&lt;section&gt;».ast.List }
    method section($/) { make ~«@&lt;line&gt;.List       }
    method line($/)    { make ~$/.trim             }
    method comment($/) { make Empty                }
}
</code></pre><h3 id="提取">提取</h3>
<pre><code class="language-perl6" data-lang="perl6">my $em = ExtractSection.parse(
    $excerpt, 
    :actions(ExtractSectionAction)
).ast;

for @$em -&gt; $line {
    say $line.perl;
    say '-' x 35;
}
</code></pre><h3 id="输出">输出</h3>
<pre><code>$(&quot;This code block is what we're after.&quot;, &quot;We'll use 'ff' to get it.&quot;)
-----------------------------------
$(&quot;I want this line.&quot;, &quot;and this line as well.&quot;, &quot;HaHa&quot;)
-----------------------------------
$(&quot;Let's to go home.&quot;,)
-----------------------------------
</code></pre>
        
      
      </div>
    
    </div>
    
    
    <div class="post on-list coding">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/subparse/">子解析</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-05-05 21:51:42
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/grammar/">Grammar</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <h3 id="子解析">子解析</h3>
<p>游标不一定要到达字符串的末尾才算成功。也就是说，它不一定要匹配整个字符串。</p>
<p><code>subparse</code> 总是返回一个 <strong>Match</strong> 对象</p>
<pre><code class="language-perl6" data-lang="perl6">method subparse(
    $target, 
    :$rule = 'TOP', 
    Capture() :$args = \(),  
    Mu :$actions = Mu, 
    *%opt
)
</code></pre><h3 id="grammar">Grammar</h3>
<pre><code class="language-perl6" data-lang="perl6">grammar RepeatChar {
    token start($character) { $character+ }
}
</code></pre><h3 id="解析">解析</h3>
<pre><code class="language-perl6" data-lang="perl6">say RepeatChar.subparse(
    'bbbabb', 
    :rule('start'), 
    :args(\('b'))
);          # ｢bbb｣

say RepeatChar.parse(
    'bbbabb', 
    :rule('start'), 
    :args(\('b'))
);          # Nil

say RepeatChar.subparse(
    'bbbabb', 
    :rule('start'), 
    :args(\('a'))
);          # &lt;failed match&gt;

say RepeatChar.subparse(
    'bbbabb', 
    :rule('start'), 
    :args(\('a')), 
    :pos(3)
);          # ｢a｣
</code></pre>
        
      
      </div>
    
    </div>
    
    
    <div class="post on-list coding">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/parse-structured-text/">解析结构化文本</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-05-05 21:46:27
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/grammar/">Grammar</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <h3 id="数据样例">数据样例</h3>
<pre><code>[28/04/2015 12:32] Title1

content line 1
content line 2
content line 3
content line 4
content line 5

[28/04/2015 12:16] Title2

content line 6
content line 7

[27/04/2015 17:30] ​Title3

content line 8
content line 9
content line 10

</code></pre><h3 id="grammar">Grammar</h3>
<pre><code class="language-perl6" data-lang="perl6">grammar StructedText {
    token TOP { ^ &lt;entry&gt;+ $ }
    token entry {
        &lt;head&gt; \s*   # 每一项有一个标题
        &lt;line&gt;+ \s*  # 每个标题下面有很多行
    }
    
    token head     { '[' &lt;datetime&gt; ']' \s+ &lt;title&gt; }
    token datetime {  &lt;filedate&gt; \s+  &lt;filetime&gt; }
    token filedate { [\d+]+ % '/' }
    token filetime { [\d+]+ % ':' }
    token title    { \N+          }
    token line  {
        [
		    &lt;!head&gt;       # 前面不是 head 标题
            .             # 点号匹配换行符
        ]+
    }
}
</code></pre><h3 id="action">Action</h3>
<pre><code class="language-perl6" data-lang="perl6">class StructedText::Actions {
    method line    ($/) { $/.make: ~$/                            }
    method filedate($/) { $/.make: ~$/.subst(rx/&lt;[:/]&gt;/, '-', :g) }
    method head    ($/) { $/.make: ~$/.subst(rx/&lt;[:/]&gt;/, '-', :g) }
    method entry   ($/) { make $&lt;head&gt;.ast =&gt; $&lt;line&gt;».made;      }
    method TOP     ($/) { $/.make: $&lt;entry&gt;».ast;                 }    
}
</code></pre><h3 id="解析">解析</h3>
<pre><code class="language-perl6" data-lang="perl6">my $actions = StructedText::Actions.new;
my $parsed = StructedText.parsefile('sample.txt', :$actions).made;
if $parsed {
    for @$parsed -&gt; $e {
        my $filename = ~$e.key.match(/'[' &lt;( &lt;-[\[\]]&gt;+ )&gt; ']'/)  ~ &quot;.txt&quot;;
        my $fh = open $filename, :w; 
        $fh.say: ~$e.key;
        for $e.value -&gt; $v {
            $fh.say: $v;
        }
        $fh.close;
        say &quot;生成文件 $filename &quot;;       
    }
}
</code></pre>
        
      
      </div>
    
    </div>
    
    
    <div class="post on-list coding">
    
      <h1 class="post-title"><a href="https://ohmypanda.github.io/calc-lang/">计算器</a></h1>
      <div class="post-meta">
        
          <span class="post-date">
            2020-05-05 21:27:02
          </span>
        

        
        <span class="">
          
            #<a href="https://ohmypanda.github.io/tags/grammar/">Grammar</a>&nbsp;
          
        </span>
        
      </div>

      

      <div class="post-content $PostCate">
      
        <h3 id="数据样例">数据样例</h3>
<pre><code>x = 40 + 2;
print x;

y = x - (5/2);
print y;

z = 1 + y * x;
print z;

print 14 - 16/3 + x;
</code></pre><p>目录结构如下:</p>
<pre><code>.
├── Lang
│   ├── Actions.pm6
│   └── Grammar.pm6
├── data
│   ├── calc.lang
</code></pre><h3 id="grammar">Grammar</h3>
<p><strong>Grammar.pm6</strong> 的内容如下:</p>
<pre><code class="language-perl6" data-lang="perl6">unit grammar Lang::Grammar;

rule TOP {
    ^ &lt;statements&gt; $
}

rule statements {
    &lt;statement&gt;+ %% ';'
}

rule statement {
    | &lt;assignment&gt;
    | &lt;printout&gt;
}

rule assignment {
    &lt;identifier&gt; '=' &lt;expression&gt;
}

rule printout {
    'print' &lt;expression&gt;
}

rule expression {
    | &lt;term&gt;+ %% $&lt;op&gt;=(['+'|'-'])
    | &lt;group&gt;
}

rule term {
    &lt;factor&gt;+  %% $&lt;op&gt;=(['*'|'/'])
}

rule factor {
    | &lt;identifier&gt;
    | &lt;value&gt;
    | &lt;group&gt;
}

rule group {
    '(' &lt;expression&gt; ')'
}

token identifier {
    (&lt;:alpha&gt;+)
}

token value {
    (
    | \d+['.' \d+]?
    | '.' \d+
    )
}
</code></pre><h3 id="action">Action</h3>
<p><strong>Actions.pm6</strong> 的内容如下:</p>
<pre><code class="language-perl6" data-lang="perl6">unit class Lang::Actions;

has %.var;

method assignment($/) {
    %!var{$&lt;identifier&gt;} = $&lt;expression&gt;.ast;
}

method printout($/) {
    say $&lt;expression&gt;.ast;
}

method expression($/) {
    if $&lt;group&gt; {
        $/.make: $&lt;group&gt;.ast
    }
    else {
        my $result = $&lt;term&gt;[0].ast;

        if $&lt;op&gt; {
            my @ops = $&lt;op&gt;.map(~*);
            my @vals = $&lt;term&gt;[1..*].map(*.ast);

            for 0..@ops.elems - 1 -&gt; $c {
                if @ops[$c] eq '+' {
                    $result += @vals[$c];
                }
                else {
                    $result -= @vals[$c];
                }
            }
        }

        $/.make: $result;
    }
}

method term($/) {
    my $result = $&lt;factor&gt;[0].ast;

    if $&lt;op&gt; {
        my @ops = $&lt;op&gt;.map(~*);
        my @vals = $&lt;factor&gt;[1..*].map(*.ast);

        for 0..@ops.elems - 1 -&gt; $c {
            if @ops[$c] eq '*' {
                $result *= @vals[$c];
            }
            else {
                $result /= @vals[$c];
            }
        }
    }

    $/.make: $result;
}

method factor($/) {
    if $&lt;identifier&gt; {
        $/.make: %!var{~$&lt;identifier&gt;} // 0
    }
    elsif $&lt;value&gt; {
        $/.make: $&lt;value&gt;.ast
    }
    elsif $&lt;group&gt; {
        $/.make: $&lt;group&gt;.ast
    }
}

method group($/) {
    $/.make: $&lt;expression&gt;.ast
}

method identifier($/) {
    $/.make: ~$0
}

method value($/) {
    $/.make: +$0
}
</code></pre><h3 id="解析">解析</h3>
<pre><code class="language-perl6" data-lang="perl6">use lib '.';
use Lang::Grammar;
use Lang::Actions;

my $parsed = Lang::Grammar.parsefile(@*ARGS[0] // 'data/calc.lang', :actions(Lang::Actions.new()));
say $parsed;
</code></pre>
        
      
      </div>
    
    </div>
    
    <div class="pagination">
  <div class="pagination__buttons">
    
    
      <span class="button next">
        <a href="/page/2/">
          <span class="button__text">下 一 页</span>
          <span class="button__icon">→</span>
        </a>
      </span>
    
  </div>
</div>

  </div>

      </div>

      
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


<footer class="footer">
  <div class="footer__inner">
    <div class="copyright">
      <span>共 35 篇文章</span><span> 5562 字</span>
    </div>
    
      <div class="copyright">
        <span>© 2020 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a> Theme by <a href="https://twitter.com/panr" target="_blank" rel="noopener">Panr</a></span>
      </div>
    
  </div>
</footer>

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/lmm214/immmmm@gh-pages/main.js"></script>

<script type="text/javascript" src='https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js'></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/lmm214/immmmm@gh-pages/lately.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/lmm214/immmmm@gh-pages/waterfall.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/lmm214/immmmm@gh-pages/slimbox2.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/lmm214/immmmm@gh-pages/al.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module"></script>

      
    </div>
  </body>
</html>
